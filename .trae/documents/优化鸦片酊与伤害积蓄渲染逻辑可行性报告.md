# 优化“鸦片酊”和“伤害积累”渲染逻辑的方案

## 可行性分析结论
通过 `Client.player` 直接读取 NBT 来优化渲染逻辑是**不完全可行**的。
- **原因**：玩家的 `persistentData`（存储韧性和伤害积蓄的地方）存储在 NBT 的 `ForgeCaps` 中，Minecraft 默认**不会**将其同步到客户端。目前代码通过 `player.sendData` 手动同步，但由于设置了每秒同步一次（`if (player.age % 20) return;`），导致进度条更新有明显的延迟感。

## 推荐优化方案：使用自定义属性 (Attributes)
推荐将韧性和伤害积蓄从 `persistentData` 迁移到 **自定义属性**。
- **优势**：
  1. **自动同步**：Minecraft 会自动将属性值同步到客户端。
  2. **高平滑度**：客户端每刻（Tick）都能读取到最新值，渲染将变得非常丝滑（20Hz 更新）。
  3. **代码简化**：无需再手动编写数据包发送和接收逻辑。

## 实施步骤

### 1. 注册新属性
在 [Attribute.js](file:///e:/MC_UNSpro/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%832/.minecraft/kubejs/startup_scripts/Attribute.js) 中注册 `rainbow:generic.resilience` 和 `rainbow:generic.damage_num`。

### 2. 更新服务端逻辑
在 [PlayerEvents.js](file:///e:/MC_UNSpro/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%832/.minecraft/kubejs/server_scripts/PlayerEvents.js) 中：
- 将修改 `persistentData` 的逻辑改为修改属性值（使用 `player.setAttributeBaseValue`）。
- 移除 `resilience_gui` 数据包的发送逻辑。

### 3. 更新客户端渲染逻辑
在 [render.js](file:///e:/MC_UNSpro/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%832/.minecraft/kubejs/client_scripts/curios_skill_system/render.js) 中：
- 移除 `NetworkEvents.dataReceived` 监听器。
- 在 `ClientEvents.tick` 中，直接通过 `player.getAttributeValue()` 获取数值。
- 同样在客户端直接判断饰品佩戴情况，进一步减少对服务器数据的依赖。

是否按照此方案进行优化？
